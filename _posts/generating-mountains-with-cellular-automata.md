---
title: Generating Mountains
date: '2016-11-29'
tumblr_url: https:blog.jono.tech/post/153847758590/generating-mountains-with-cellular-automata
description: Using Cellular Automata to generate mountains
image: /img/tumblr_inline_ohfsrgdQYC1qil7jn_540.png
tags:
    - procgen
---


<p>Welcome to another “Is Jono obsessed with procedural generation?”.</p><figure data-orig-width="1276" data-orig-height="680" class="tmblr-full"><img src="/img/tumblr_inline_ohi26slNl31qil7jn_540.png" alt="image" data-orig-width="1276" data-orig-height="680"/></figure><p>This week I read a <a href="https://blog.jrheard.com/procedural-dungeon-generation-cellular-automata" target="_blank">great article</a> on HackerNews. This prompted me to create a procedural mountain generator based on Cellular Automata (CA), an algorithm in which a collection of cells change state over time based on their neighbouring cells.</p>

<p>In CA a group of cells is iterated on over again and again, each time the cell’s state is determined by its neighbouring cells. </p><p>I’m not going to go into great detail here because it has already been done much better than I would have <a href="https://natureofcode.com/book/chapter-7-cellular-automata/" target="_blank">here</a> (chapter 7.2 is particularly relevant to what I am doing here).</p><p>But after reading that and seeing some awesome pictures like the one below (<a href="https://mathworld.wolfram.com/Rule30.html" target="_blank">Rule 30</a> of the elementary CA), I decided to give it a crack.</p><figure data-orig-width="501" data-orig-height="251" class="tmblr-full"><img src="/img/tumblr_inline_ohf7vtKjiD1qil7jn_540.jpg" alt="image" data-orig-width="501" data-orig-height="251"/></figure><p>After I creating the elementary cellular automata like the above I added randomness by intermittently swapping between the basic rules. <br/></p><p>Add some colour and&hellip;</p><figure data-orig-width="2860" data-orig-height="1598" class="tmblr-full"><img src="/img/tumblr_inline_ohf87002XD1qil7jn_540.png" alt="image" data-orig-width="2860" data-orig-height="1598"/></figure><p>Next I wanted to make it a bit more interesting. Trees are randomly placed anywhere there was solid ground (i.e. the black in the above picture). They appear randomly with a higher chance of spawning the further down the mountain. An example with new colours is below&hellip;</p><figure data-orig-width="2526" data-orig-height="1318" class="tmblr-full"><img src="/img/tumblr_inline_ohf8n8N0951qil7jn_540.png" alt="image" data-orig-width="2526" data-orig-height="1318"/></figure><p>You also might have spotted the cave at the top, they have a chance of spawning wherever there is a flat piece of ground that extends for at least 5 pixels. They are also a lot less common than trees.</p><p>You might also note that in the above picture there are multiple mountains, I changed the cellular automata rules slightly, so that if the above 3 cells are totally empty then there is a small chance that the cell will be filled. A single filled cell triggers each line below to expand on it creating another mountain.</p><p>Next on my list to spruce things up was waterfalls&hellip;</p><figure data-orig-width="2546" data-orig-height="1236" class="tmblr-full"><img src="/img/tumblr_inline_ohf8vynhSP1qil7jn_540.png" alt="image" data-orig-width="2546" data-orig-height="1236"/></figure><p>To make the waterfalls it was easier to do a second pass on the whole scene, this is because the scene is generated from top to bottom and I would need to keep track of the waterfall the whole way down. So instead I just loop through looking for nice flat pieces of rock face and draw the whole waterfall. I also dither the waterfall left and right when passing down over parts of the mountain that weren’t entirely flat.</p><figure data-orig-width="2846" data-orig-height="1572" class="tmblr-full"><img src="/img/tumblr_inline_ohfsrgdQYC1qil7jn_540.png" alt="image" data-orig-width="2846" data-orig-height="1572"/></figure><p>Lastly I added some fog just by throwing a layer of white over the top, making sure that the opacity increases as it goes down. I also randomly changed the colour of a bunch to give the rock face a nice speckled look.</p><p>Done and just in time for <a href="https://www.reddit.com/r/proceduralgeneration" target="_blank">r/proceduralgeneration</a> November challenge.</p><p>Feel free to have a play with the generator <a href="https://foopod.github.io/proc-hill/" target="_blank">here</a>.</p>
